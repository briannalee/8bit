(()=>{"use strict";var t={765:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.BinaryNumber=void 0;var s=e(399),n=function(){function t(t,i,e){this.env=t,this.row=i,this.decimalValue=null!=e?e:0,this.binaryValue=this.decimalValue.toString(2);var s=2*Math.round(this.binaryValue.length/2);this.bits=s>this.env.columns?s:this.env.columns,this.VisualBits=new Array(this.bits),this.createVisualBits(),this.setDecimal(this.decimalValue)}return t.prototype.setCircleValues=function(){var t=!1,i=this.binaryValue;this.VisualBits.length<i.length&&(i=i.substring(i.length-this.VisualBits.length),i=this.setCharAt(i,0,"1"),t=!0);for(var e=this.VisualBits.length-1;e>=0;e--)this.VisualBits[e].setOverflow(t),this.VisualBits[e].setBit("1"==i.charAt(e))},t.prototype.createVisualBits=function(){for(var t=this.bits-1;t>=0;t--)this.VisualBits[t]=this.addVisualBit(t)},t.prototype.addVisualBit=function(t){return new s.VisualBit(this.env.startX+t*this.env.spacing,this.env.startY+this.env.radius+this.env.spacing*this.row,this.env.radius,this.env)},t.prototype.getDecimal=function(){return this.decimalValue},t.prototype.getBinary=function(){return this.binaryValue},t.prototype.setBit=function(t,i){i=null!=i?i:!this.VisualBits[t].set,this.binaryValue=this.setCharAt(this.binaryValue,t,i?"1":"0"),this.VisualBits[t].setBit(i),this.decimalValue=parseInt(this.binaryValue,2)},t.prototype.updateBinaryString=function(){this.binaryValue=this.decimalValue.toString(2),this.binaryValue.length<this.env.columns&&(this.binaryValue=this.binaryValue.padStart(this.env.columns,"0"))},t.prototype.setDecimal=function(t){this.decimalValue=t,this.updateBinaryString(),this.setCircleValues()},t.prototype.setCharAt=function(t,i,e){return i>t.length-1?t:t.substring(0,i)+e+t.substring(i+1)},t}();i.BinaryNumber=n},438:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CanvasStage=void 0;var s=e(607),n=e(251),r=function(){function t(t){var i,e;if(this.environment=t,document.body.style.backgroundColor="black",!(this.canvas=document.createElement("canvas")))throw new Error("Unable to create canvas");if(this.canvas.id="viewport",!(e=document.getElementById("main")))throw new Error("Unable to append canvas to container");if(e.append(this.canvas),!(this.context=this.canvas.getContext("2d")))throw new Error("2d context not supported or canvas already initialized");var r=this;this.canvas.addEventListener("mouseup",(function(t){r.mouseClickEvent(t)})),null===(i=document.getElementById("compute"))||void 0===i||i.addEventListener("click",(function(t){(0,n.Compute)(r.environment)}));var a=document.getElementById("bits");a&&a.addEventListener("input",(function(t){var i;(i=parseInt(a.value))&&(0,s.ChangeBitSize)(i)})),this.canvas.width=t.width,this.canvas.height=t.height,this.drawLine()}return t.prototype.getMousePosition=function(t){var i=this.canvas.getBoundingClientRect(),e=this.canvas.width/i.width,s=this.canvas.height/i.height;return{x:(t.clientX-i.left)*e,y:(t.clientY-i.top)*s}},t.prototype.mouseClickEvent=function(t){for(var i=this.getMousePosition(t),e=0;e<this.environment.rows;e++){var s=this.environment.spacing,n=this.environment.startY,r=this.environment.startX,a=this.environment.radius;if(i.y>n+e*s&&i.y<n+e*s+s)for(var o=0;o<this.environment.columns;o++)i.x>r+(o*s-a)&&i.x<r+(o*s+a)&&this.environment.BinaryNumbers[e].setBit(o)}},t.prototype.drawLine=function(){this.context.beginPath();var t=this.environment.startY+this.environment.spacing/4+this.environment.rows*this.environment.spacing,i=this.environment.startX-this.environment.radius;this.context.moveTo(i,t),this.context.lineTo(i+this.environment.columns*this.environment.spacing,t),this.context.strokeStyle="white",this.context.stroke(),this.context.closePath()},t.prototype.drawButtons=function(){},t}();i.CanvasStage=r},115:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.debounce=void 0,i.debounce=function(t,i){var e=void 0;return function(){for(var s=[],n=0;n<arguments.length;n++)s[n]=arguments[n];return e||((e={}).promise=new Promise((function(t,i){e.resolve=t,e.reject=i}))),clearTimeout(e.timeout),e.latestArgs=s,e.timeout=setTimeout((function(){var i=e;e=void 0;try{i.resolve(t.apply(void 0,i.latestArgs))}catch(t){i.reject(t)}}),i),e.promise}}},116:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Environment=void 0;var s=e(438),n=e(765);i.Environment=function(t,i){this.pagePadding=10,this.minWidth=10,this.columns=t,this.rows=i,this.width=document.getElementById("main").offsetWidth-2*this.pagePadding,this.height=document.getElementById("main").offsetHeight-2*this.pagePadding,this.MaxBits=Math.floor(this.width/(2*this.minWidth+5)),this.columns=Math.max(Math.min(this.MaxBits,this.columns),2),document.getElementById("bits").value=this.columns.toString(),this.radius=Math.max(this.minWidth,Math.floor(Math.min((this.width-5*this.columns)/2/this.columns,(this.height-5*(this.rows+2))/2/(this.rows+2)))),console.log((this.width-5*this.columns)/2/this.columns),this.spacing=2*this.radius+5;var e=this.columns*this.spacing-10,r=(this.width-e)/2+this.radius,a=(this.rows+2)*this.spacing,o=(this.height-a)/2;this.startX=r,this.startY=o,this.circles=new Array(this.rows),this.BinaryNumbers=new Array(this.rows),this.canvas=new s.CanvasStage(this),this.results=new n.BinaryNumber(this,this.rows+1);for(var h=0;h<this.rows;h++)this.BinaryNumbers[h]=new n.BinaryNumber(this,h)}},251:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Compute=void 0,i.Compute=function(t){for(var i=0,e=0;e<t.rows;e++)i+=t.BinaryNumbers[e].getDecimal();t.results.setDecimal(i)}},399:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.VisualBit=void 0;var e=function(){function t(t,i,e,s,n){this.x=t,this.y=i,this.set=null!=n&&n,this.radius=e,this.left=this.x-e-1,this.top=this.y-e-1,this.right=this.x+e+1,this.bottom=this.y+e+1,this.env=s,this.fillColor="white",this.draw()}return t.prototype.switchBit=function(){this.set=!this.set,this.draw()},t.prototype.setBit=function(t){this.set=t,this.draw()},t.prototype.setOverflow=function(t){this.fillColor=t?"red":"white"},t.prototype.draw=function(){var t=this.env.canvas.context;t.clearRect(this.left,this.top,2*this.radius+2,2*this.radius+2),t.beginPath(),t.arc(this.x,this.y,this.radius,0,2*Math.PI),t.fillStyle=this.set?this.fillColor:"#0f0f0f",t.strokeStyle=this.set?"#95c299":"#330400",t.fill(),t.stroke(),t.closePath()},t}();i.VisualBit=e},607:(t,i,e)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ChangeBitSize=void 0;var s,n=e(115),r=e(116),a=(0,n.debounce)(c,200),o=(0,n.debounce)((function(t){t=Math.min(s.MaxBits,t),t=Math.max(2,t),document.getElementById("bits").value=t.toString(),h=t,c()}),200),h=8,u=2;function l(){s=new r.Environment(h,u)}function c(){if(null!=document.getElementById("viewport")){document.getElementById("viewport").remove();var t=s.BinaryNumbers,i=s.results;l(),s.results.setDecimal(i.getDecimal());for(var e=0;e<t.length;e++){var n=t[e].getBinary();n=n.substring(n.length-h),s.BinaryNumbers[e].setDecimal(parseInt(n,2))}}}l(),window.addEventListener("resize",(function(t){a()})),i.ChangeBitSize=function(t){o(t)}}},i={};!function e(s){var n=i[s];if(void 0!==n)return n.exports;var r=i[s]={exports:{}};return t[s](r,r.exports,e),r.exports}(607)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SCxHQUcvQ0ksRUFBT0QsT0FDZixDQ25CMEJILENBQW9CLEkiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly84Yml0Ly4vc3JjL0JpbmFyeU51bWJlci50cyIsIndlYnBhY2s6Ly84Yml0Ly4vc3JjL0NhbnZhc1N0YWdlLnRzIiwid2VicGFjazovLzhiaXQvLi9zcmMvRGVib3VuY2VWYWx1ZS50cyIsIndlYnBhY2s6Ly84Yml0Ly4vc3JjL0Vudmlyb25tZW50LnRzIiwid2VicGFjazovLzhiaXQvLi9zcmMvTWF0aEhlbHBlci50cyIsIndlYnBhY2s6Ly84Yml0Ly4vc3JjL1Zpc3VhbEJpdC50cyIsIndlYnBhY2s6Ly84Yml0Ly4vc3JjL2luZGV4LnRzIiwid2VicGFjazovLzhiaXQvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vOGJpdC93ZWJwYWNrL3N0YXJ0dXAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsga2lsbCB9IGZyb20gXCJwcm9jZXNzXCI7XG5pbXBvcnQgeyBDaGFuZ2VCaXRTaXplIH0gZnJvbSBcIi5cIjtcbmltcG9ydCB7IEVudmlyb25tZW50IH0gZnJvbSBcIi4vRW52aXJvbm1lbnRcIjtcbmltcG9ydCB7IFZpc3VhbEJpdCB9IGZyb20gXCIuL1Zpc3VhbEJpdFwiO1xuXG4vKipcbiAqIE51bWJlciBjbGFzcyByZXByZXNlbnRzIGEgdmFsdWUgKG9uZSBjb2x1bW4pLCBjb250YWluaW5nIHRoZSBkZWNpbWFsICYgYmluYXJ5IHZhbHVlXG4gKiBIb2xkcyB0aGUgYXJyYXkgb2YgY2lyY2xlcyB1c2VkIHRvIHZpc3VhbGx5IHJlcHJlc2VudCB0aGUgYmluYXJ5IHZhbHVlXG4gKi9cbmV4cG9ydCBjbGFzcyBCaW5hcnlOdW1iZXIge1xuICAgIHByaXZhdGUgYml0czogbnVtYmVyO1xuICAgIHByaXZhdGUgZGVjaW1hbFZhbHVlOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBiaW5hcnlWYWx1ZTogc3RyaW5nO1xuICAgIHB1YmxpYyBWaXN1YWxCaXRzOiBWaXN1YWxCaXRbXTtcbiAgICBwcml2YXRlIGVudjogRW52aXJvbm1lbnQ7XG4gICAgcHJpdmF0ZSByb3c6IG51bWJlcjtcblxuICAgIHB1YmxpYyBjb25zdHJ1Y3RvcihlbnY6IEVudmlyb25tZW50LCByb3c6IG51bWJlcik7XG4gICAgcHVibGljIGNvbnN0cnVjdG9yKGVudjogRW52aXJvbm1lbnQsIHJvdzogbnVtYmVyLCBkZWNpbWFsVmFsdWU/OiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5lbnYgPSBlbnY7XG4gICAgICAgIHRoaXMucm93ID0gcm93O1xuICAgICAgICB0aGlzLmRlY2ltYWxWYWx1ZSA9IGRlY2ltYWxWYWx1ZSA/PyAwO1xuICAgICAgICB0aGlzLmJpbmFyeVZhbHVlID0gdGhpcy5kZWNpbWFsVmFsdWUudG9TdHJpbmcoMik7XG4gICAgICAgIGNvbnN0IG5ld0JpdHMgPSAyICogTWF0aC5yb3VuZCh0aGlzLmJpbmFyeVZhbHVlLmxlbmd0aCAvIDIpO1xuICAgICAgICB0aGlzLmJpdHMgPSBuZXdCaXRzID4gdGhpcy5lbnYuY29sdW1ucyA/IG5ld0JpdHMgOiB0aGlzLmVudi5jb2x1bW5zO1xuICAgICAgICB0aGlzLlZpc3VhbEJpdHMgPSBuZXcgQXJyYXkodGhpcy5iaXRzKTtcbiAgICAgICAgdGhpcy5jcmVhdGVWaXN1YWxCaXRzKCk7XG4gICAgICAgIHRoaXMuc2V0RGVjaW1hbCh0aGlzLmRlY2ltYWxWYWx1ZSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXRDaXJjbGVWYWx1ZXMoKSB7XG4gICAgICAgIGxldCBvdmVyZmxvdzogYm9vbGVhbiA9IGZhbHNlO1xuICAgICAgICBsZXQgYmluYXJ5OiBzdHJpbmcgPSB0aGlzLmJpbmFyeVZhbHVlO1xuXG4gICAgICAgIGlmICh0aGlzLlZpc3VhbEJpdHMubGVuZ3RoIDwgYmluYXJ5Lmxlbmd0aCkge1xuICAgICAgICAgICAgYmluYXJ5ID0gYmluYXJ5LnN1YnN0cmluZyhiaW5hcnkubGVuZ3RoLXRoaXMuVmlzdWFsQml0cy5sZW5ndGgpO1xuICAgICAgICAgICAgYmluYXJ5ID0gdGhpcy5zZXRDaGFyQXQoYmluYXJ5LDAsXCIxXCIpO1xuICAgICAgICAgICAgb3ZlcmZsb3cgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IHRoaXMuVmlzdWFsQml0cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgdGhpcy5WaXN1YWxCaXRzW2ldLnNldE92ZXJmbG93KG92ZXJmbG93KTtcbiAgICAgICAgICAgIHRoaXMuVmlzdWFsQml0c1tpXS5zZXRCaXQoYmluYXJ5LmNoYXJBdChpKSA9PSBcIjFcIiA/IHRydWUgOiBmYWxzZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGNyZWF0ZVZpc3VhbEJpdHMoKSB7XG4gICAgICAgIGZvciAobGV0IGMgPSB0aGlzLmJpdHMtMTsgYyA+PSAwOyBjLS0pIHtcbiAgICAgICAgICAgIHRoaXMuVmlzdWFsQml0c1tjXT0gdGhpcy5hZGRWaXN1YWxCaXQoYyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGFkZFZpc3VhbEJpdChjb2x1bW46IG51bWJlcikgOiBWaXN1YWxCaXQge1xuICAgICAgICByZXR1cm4gbmV3IFZpc3VhbEJpdCh0aGlzLmVudi5zdGFydFggKyBjb2x1bW4gKiB0aGlzLmVudi5zcGFjaW5nLCB0aGlzLmVudi5zdGFydFkgKyB0aGlzLmVudi5yYWRpdXMgKyB0aGlzLmVudi5zcGFjaW5nICogdGhpcy5yb3csIHRoaXMuZW52LnJhZGl1cywgdGhpcy5lbnYpO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXREZWNpbWFsKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLmRlY2ltYWxWYWx1ZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0QmluYXJ5KCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLmJpbmFyeVZhbHVlO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXRCaXQoaW5kZXg6IG51bWJlciwgYm9vbD86IGJvb2xlYW4pIHtcbiAgICAgICAgYm9vbCA9IGJvb2wgPz8gIXRoaXMuVmlzdWFsQml0c1tpbmRleF0uc2V0O1xuICAgICAgICB0aGlzLmJpbmFyeVZhbHVlID0gdGhpcy5zZXRDaGFyQXQodGhpcy5iaW5hcnlWYWx1ZSxpbmRleCwgYm9vbCA/IFwiMVwiOlwiMFwiKTtcbiAgICAgICAgdGhpcy5WaXN1YWxCaXRzW2luZGV4XS5zZXRCaXQoYm9vbCk7XG4gICAgICAgIHRoaXMuZGVjaW1hbFZhbHVlID0gcGFyc2VJbnQodGhpcy5iaW5hcnlWYWx1ZSwgMik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB1cGRhdGVCaW5hcnlTdHJpbmcoKSB7XG4gICAgICAgIHRoaXMuYmluYXJ5VmFsdWUgPSB0aGlzLmRlY2ltYWxWYWx1ZS50b1N0cmluZygyKTtcbiAgICAgICAgaWYgKHRoaXMuYmluYXJ5VmFsdWUubGVuZ3RoIDwgdGhpcy5lbnYuY29sdW1ucykgdGhpcy5iaW5hcnlWYWx1ZSA9IHRoaXMuYmluYXJ5VmFsdWUucGFkU3RhcnQodGhpcy5lbnYuY29sdW1ucyxcIjBcIik7XG4gICAgfVxuXG4gICAgcHVibGljIHNldERlY2ltYWwoZGVjaW1hbFZhbHVlIDogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuZGVjaW1hbFZhbHVlID0gZGVjaW1hbFZhbHVlO1xuICAgICAgICB0aGlzLnVwZGF0ZUJpbmFyeVN0cmluZygpO1xuICAgICAgICB0aGlzLnNldENpcmNsZVZhbHVlcygpO1xuICAgIH1cblxuICAgIHByaXZhdGUgc2V0Q2hhckF0KHN0cjogc3RyaW5nLGluZGV4OiBudW1iZXIsY2hyOiBzdHJpbmcpIHtcbiAgICAgICAgaWYoaW5kZXggPiBzdHIubGVuZ3RoLTEpIHJldHVybiBzdHI7XG4gICAgICAgIHJldHVybiBzdHIuc3Vic3RyaW5nKDAsaW5kZXgpICsgY2hyICsgc3RyLnN1YnN0cmluZyhpbmRleCsxKTtcbiAgICB9XG59XG5cbiIsImltcG9ydCB7IHN0YXJ0IH0gZnJvbSBcInJlcGxcIjtcbmltcG9ydCB7IENoYW5nZUJpdFNpemUgfSBmcm9tIFwiLlwiO1xuaW1wb3J0IHsgRW52aXJvbm1lbnQgfSBmcm9tIFwiLi9FbnZpcm9ubWVudFwiO1xuaW1wb3J0IHsgQ29tcHV0ZSB9IGZyb20gXCIuL01hdGhIZWxwZXJcIjtcblxuLyoqXG4gKiBJbnRlcmZhY2UgdG8gaG9sZCBjb29yZGluYXRlcyBmb3IgYSBtb3VzZSBjbGljayBldmVudFxuICovXG5leHBvcnQgaW50ZXJmYWNlIG1vdXNlQ2xpY2sge1xuICAgIHg6IG51bWJlcjtcbiAgICB5OiBudW1iZXI7XG59XG5cbmV4cG9ydCBjbGFzcyBDYW52YXNTdGFnZSB7XG4gICAgLyoqXG4gICAgICogQ29udGFpbnMgaW5mbyBhYm91dCB0aGUgY2FudmFzIERPTSBvYmplY3RcbiAgICAgKi9cbiAgICBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50O1xuICAgIGNvbnRleHQ6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRDtcbiAgICBlbnZpcm9ubWVudDogRW52aXJvbm1lbnQ7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgY2FudmFzIHRvIGRyYXcgb24sIGhhbmRsaW5nIGlucHV0XG4gICAgICogXG4gICAgICogQHBhcmFtIGVudmlyb25tZW50IC0gVGhlIEVudmlyb25tZW50IGNsYXNzIHRoYXQgY3JlYXRlZCB0aGlzIGNhbnZhc1xuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGVudmlyb25tZW50OiBFbnZpcm9ubWVudCkge1xuICAgICAgICB0aGlzLmVudmlyb25tZW50ID0gZW52aXJvbm1lbnQ7XG5cbiAgICAgICAgLy8gU2V0IGJhY2tncm91bmQgY29sb3IgdG8gYmxhY2tcbiAgICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcImJsYWNrXCI7XG5cbiAgICAgICAgLy8gQ3JlYXRlIGNhbnZhcyBhbmQgYXBwZW5kIHRvIHBhZ2UsIHdpdGggZXJyb3IgaGFuZGxpbmdcbiAgICAgICAgaWYgKCEodGhpcy5jYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpIGFzIEhUTUxDYW52YXNFbGVtZW50KSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5hYmxlIHRvIGNyZWF0ZSBjYW52YXNcIik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gU2V0IElEIG9mIHRoZSBjYW52YXMsIGZvciBDU1Mgc3R5bGluZ1xuICAgICAgICB0aGlzLmNhbnZhcy5pZCA9IFwidmlld3BvcnRcIjtcbiAgICAgICAgXG4gICAgICAgIC8vIEFwcGVuZCB0aGUgY2FudmFzIHRvIHRoZSBjb250YWluZXIgZGl2LCB3aXRoIGVycm9yIGhhbmRsaW5nXG4gICAgICAgIGxldCBjb250YWluZXJEaXY6IEhUTUxFbGVtZW50O1xuICAgICAgICBpZiAoIShjb250YWluZXJEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1haW5cIikhKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5hYmxlIHRvIGFwcGVuZCBjYW52YXMgdG8gY29udGFpbmVyXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnRhaW5lckRpdi5hcHBlbmQodGhpcy5jYW52YXMpIVxuICAgICAgICBcbiAgICAgICAgLy8gR2V0IGNvbnRleHQsIHdpdGggZXJyb3IgaGFuZGxpbmdcbiAgICAgICAgaWYgKCEodGhpcy5jb250ZXh0ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpISkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIjJkIGNvbnRleHQgbm90IHN1cHBvcnRlZCBvciBjYW52YXMgYWxyZWFkeSBpbml0aWFsaXplZFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vQWRkIGlucHV0IGV2ZW50IGhhbmRsaW5nXG4gICAgICAgIGxldCBjbGFzc0FjY2Vzc29yID0gdGhpcztcbiAgICAgICAgdGhpcy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgZnVuY3Rpb24oZSlcbiAgICAgICAge1xuICAgICAgICAgICAgY2xhc3NBY2Nlc3Nvci5tb3VzZUNsaWNrRXZlbnQoZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29tcHV0ZVwiKT8uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgQ29tcHV0ZShjbGFzc0FjY2Vzc29yLmVudmlyb25tZW50KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgbGV0IGJpdHNJbnB1dCA6IEhUTUxJbnB1dEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJpdHNcIikhIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgICAgIGlmIChiaXRzSW5wdXQpIHtcbiAgICAgICAgICAgIGJpdHNJbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIixmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgbGV0IHZhbHVlOiBudW1iZXI7XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlID0gcGFyc2VJbnQoYml0c0lucHV0LnZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICBDaGFuZ2VCaXRTaXplKHZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuY2FudmFzLndpZHRoID0gZW52aXJvbm1lbnQud2lkdGg7XG4gICAgICAgIHRoaXMuY2FudmFzLmhlaWdodCA9IGVudmlyb25tZW50LmhlaWdodDtcblxuICAgICAgICB0aGlzLmRyYXdMaW5lKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogXG4gICAgICogQHBhcmFtIGV2ZW50IC0gTW91c2UgY2xpY2sgZXZlbnRcbiAgICAgKiBAcmV0dXJucyAtIENvb3JkaW5hdGVzIGFzIG1vdXNlQ2xpY2sgaW50ZXJmYWNlXG4gICAgICovXG4gICAgZ2V0TW91c2VQb3NpdGlvbihldmVudDogTW91c2VFdmVudCkgOiBtb3VzZUNsaWNrIHtcbiAgICAgICAgbGV0IHJlY3QgPSB0aGlzLmNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSwgLy8gYWJzLiBzaXplIG9mIGVsZW1lbnRcbiAgICAgICAgc2NhbGVYID0gdGhpcy5jYW52YXMud2lkdGggLyByZWN0LndpZHRoLCAgICAvLyByZWxhdGlvbnNoaXAgYml0bWFwIHZzLiBlbGVtZW50IGZvciB4XG4gICAgICAgIHNjYWxlWSA9IHRoaXMuY2FudmFzLmhlaWdodCAvIHJlY3QuaGVpZ2h0OyAgLy8gcmVsYXRpb25zaGlwIGJpdG1hcCB2cy4gZWxlbWVudCBmb3IgeVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB4OiAoZXZlbnQuY2xpZW50WCAtIHJlY3QubGVmdCkgKiBzY2FsZVgsICAgLy8gc2NhbGUgbW91c2UgY29vcmRpbmF0ZXMgYWZ0ZXIgdGhleSBoYXZlXG4gICAgICAgICAgICB5OiAoZXZlbnQuY2xpZW50WSAtIHJlY3QudG9wKSAqIHNjYWxlWSAgICAgLy8gYmVlbiBhZGp1c3RlZCB0byBiZSByZWxhdGl2ZSB0byBlbGVtZW50XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZXRlY3RzIHdoaWNoIGNpcmNsZSB3YXMgY2xpY2tlZCBvbiwgYW5kIHN3aXRjaGVzIHRoYXQgYml0XG4gICAgICogXG4gICAgICogQHBhcmFtIGUgLSBUcmlnZ2VyaW5nIGV2ZW50XG4gICAgICogQHBhcmFtIGNhbnZhcyAtIENhbnZhcyBjbGFzcyB0aGF0IGlzIGN1cnJlbnRseSBiZWluZyB1c2VkXG4gICAgICovXG4gICAgbW91c2VDbGlja0V2ZW50KGU6TW91c2VFdmVudCkge1xuICAgICAgICBsZXQgbW91c2VQb3MgOiBtb3VzZUNsaWNrID0gdGhpcy5nZXRNb3VzZVBvc2l0aW9uKGUpO1xuICAgICAgICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCB0aGlzLmVudmlyb25tZW50LnJvd3M7IHJvdysrKSB7XG4gICAgICAgICAgICBjb25zdCBzcGFjaW5nID0gdGhpcy5lbnZpcm9ubWVudC5zcGFjaW5nO1xuICAgICAgICAgICAgY29uc3Qgc3RhcnRZID0gdGhpcy5lbnZpcm9ubWVudC5zdGFydFk7XG4gICAgICAgICAgICBjb25zdCBzdGFydFggPSB0aGlzLmVudmlyb25tZW50LnN0YXJ0WDtcbiAgICAgICAgICAgIGNvbnN0IHJhZGl1cyA9IHRoaXMuZW52aXJvbm1lbnQucmFkaXVzO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoKG1vdXNlUG9zLnkgPiBzdGFydFkrcm93KnNwYWNpbmcgJiYgbW91c2VQb3MueSA8IChzdGFydFkrcm93KnNwYWNpbmcpK3NwYWNpbmcpKSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgY29sID0gMDsgY29sIDwgdGhpcy5lbnZpcm9ubWVudC5jb2x1bW5zOyBjb2wrKykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoKG1vdXNlUG9zLnggPiBzdGFydFggKyAoY29sKnNwYWNpbmctcmFkaXVzKSkgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIChtb3VzZVBvcy54IDwgc3RhcnRYICsgKGNvbCpzcGFjaW5nK3JhZGl1cykpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbnZpcm9ubWVudC5CaW5hcnlOdW1iZXJzW3Jvd10uc2V0Qml0KGNvbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEcmF3cyB0aGUgZGl2aWRlciBsaW5lIGJldHdlZW4gdGhlIG51bWJlcnMgYW5kIHJlc3VsdHMgZGlzcGxheVxuICAgICAqL1xuICAgIGRyYXdMaW5lKCkge1xuICAgICAgICB0aGlzLmNvbnRleHQuYmVnaW5QYXRoKCk7XG4gICAgICAgIGNvbnN0IHlQb3MgOiBudW1iZXIgPSB0aGlzLmVudmlyb25tZW50LnN0YXJ0WSt0aGlzLmVudmlyb25tZW50LnNwYWNpbmcvNCt0aGlzLmVudmlyb25tZW50LnJvd3MqdGhpcy5lbnZpcm9ubWVudC5zcGFjaW5nO1xuICAgICAgICBjb25zdCB4UG9zIDogbnVtYmVyID0gdGhpcy5lbnZpcm9ubWVudC5zdGFydFggLSB0aGlzLmVudmlyb25tZW50LnJhZGl1cztcbiAgICAgICAgdGhpcy5jb250ZXh0Lm1vdmVUbyh4UG9zLCB5UG9zKTtcbiAgICAgICAgdGhpcy5jb250ZXh0LmxpbmVUbyh4UG9zICsgdGhpcy5lbnZpcm9ubWVudC5jb2x1bW5zKnRoaXMuZW52aXJvbm1lbnQuc3BhY2luZywgIHlQb3MpO1xuICAgICAgICB0aGlzLmNvbnRleHQuc3Ryb2tlU3R5bGUgPSBcIndoaXRlXCI7XG4gICAgICAgIHRoaXMuY29udGV4dC5zdHJva2UoKTtcbiAgICAgICAgdGhpcy5jb250ZXh0LmNsb3NlUGF0aCgpO1xuICAgIH1cblxuICAgIGRyYXdCdXR0b25zKCkge1xuXG4gICAgfVxufVxuXG4iLCIvKipcbiAqIEludm9rZXMgdGhlIGNhbGxiYWNrIGZ1bmN0aW9uIGFmdGVyIGEgd2FpdCB0aW1lIGJlZ2lubmluZyBhZnRlciB0aGUgcmV0dXJuIGZ1bmN0aW9uIHN0b3BzIGJlaW5nIGNhbGxlZC5cbiAqIFxuICogQHBhcmFtIGNhbGxiYWNrIC0gRnVuY3Rpb24gdG8gY2FsbCB3aGVuIGRvbmUgZGVib3VuY2luZ1xuICogQHBhcmFtIHdhaXQgLSBXYWl0IHRpbWVcbiAqIEByZXR1cm5zIC0gRnVuY3Rpb24gdG8gYmUgY2FsbGVkIChyZXBlYXRlZGx5KSBieSB0aGUgYWN0aW9uIHRvIGJlIGRlYm91bmNlZCAod2luZG93IHJlc2l6ZSwgZXRjKVxuICovXG5leHBvcnQgZnVuY3Rpb24gZGVib3VuY2U8VCBleHRlbmRzIHVua25vd25bXSwgVT4oXG4gICAgY2FsbGJhY2s6ICguLi5hcmdzOiBUKSA9PiBQcm9taXNlTGlrZTxVPiB8IFUsXG4gICAgd2FpdDogbnVtYmVyXG4gICkge1xuICAgIGxldCBzdGF0ZTpcbiAgICAgIHwgdW5kZWZpbmVkXG4gICAgICB8IHtcbiAgICAgICAgICB0aW1lb3V0OiBSZXR1cm5UeXBlPHR5cGVvZiBzZXRUaW1lb3V0PlxuICAgICAgICAgIHByb21pc2U6IFByb21pc2U8VT5cbiAgICAgICAgICByZXNvbHZlOiAodmFsdWU6IFUgfCBQcm9taXNlTGlrZTxVPikgPT4gdm9pZFxuICAgICAgICAgIHJlamVjdDogKHZhbHVlOiBhbnkpID0+IHZvaWRcbiAgICAgICAgICBsYXRlc3RBcmdzOiBUXG4gICAgICAgIH0gPSB1bmRlZmluZWRcbiAgXG4gICAgcmV0dXJuICguLi5hcmdzOiBUKTogUHJvbWlzZTxVPiA9PiB7XG4gICAgICBpZiAoIXN0YXRlKSB7XG4gICAgICAgIHN0YXRlID0ge30gYXMgYW55XG4gICAgICAgIHN0YXRlIS5wcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgIHN0YXRlIS5yZXNvbHZlID0gcmVzb2x2ZVxuICAgICAgICAgIHN0YXRlIS5yZWplY3QgPSByZWplY3RcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICAgIGNsZWFyVGltZW91dChzdGF0ZSEudGltZW91dClcbiAgICAgIHN0YXRlIS5sYXRlc3RBcmdzID0gYXJnc1xuICAgICAgc3RhdGUhLnRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgY29uc3QgcyA9IHN0YXRlIVxuICAgICAgICBzdGF0ZSA9IHVuZGVmaW5lZFxuICAgICAgICB0cnkge1xuICAgICAgICAgIHMucmVzb2x2ZShjYWxsYmFjayguLi5zLmxhdGVzdEFyZ3MpKVxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgcy5yZWplY3QoZSlcbiAgICAgICAgfVxuICAgICAgfSwgd2FpdClcbiAgXG4gICAgICByZXR1cm4gc3RhdGUhLnByb21pc2VcbiAgICB9XG4gIH0iLCJpbXBvcnQgeyBWaXN1YWxCaXQgfSBmcm9tIFwiLi9WaXN1YWxCaXRcIjtcbmltcG9ydCB7IENhbnZhc1N0YWdlIH0gZnJvbSBcIi4vQ2FudmFzU3RhZ2VcIjtcbmltcG9ydCB7IEJpbmFyeU51bWJlciB9IGZyb20gXCIuL0JpbmFyeU51bWJlclwiO1xuXG5leHBvcnQgY2xhc3MgRW52aXJvbm1lbnQge1xuICAgIC8qKlxuICAgICAqIENvbnRhaW5zIGluZm9ybWF0aW9uIGFib3V0IHRoZSB2aXN1YWwgY2FsY3VsYXRvclxuICAgICAqL1xuXG4gICAgLyoqXG4gICAgICogQW4gYXJyYXksIGZpcnN0IGRpbWVuc2lvbiBpcyB0aGUgcm93IChudW1iZXIpLCBzZWNvbmQgZGltZW5zaW9uIGlzIHRoZSBjb2x1bW4gKGJpdClcbiAgICAgKi9cbiAgICBjaXJjbGVzOlZpc3VhbEJpdFtdW107XG5cbiAgICAvKipcbiAgICAgKiBOdW1iZXIgY2xhc3MgYXJyYXksIGVhY2ggTnVtYmVyIGhvbGRzIGEgcm93IChudW1iZXIpXG4gICAgICovXG4gICAgQmluYXJ5TnVtYmVyczpCaW5hcnlOdW1iZXJbXTtcblxuICAgIC8qKlxuICAgICAqIEEgQmluYXJ5TnVtYmVyIHRvIGRpc3BsYXkgdGhlIHJlc3VsdHNcbiAgICAgKi9cbiAgICByZXN1bHRzOkJpbmFyeU51bWJlcjtcblxuICAgIC8qKlxuICAgICAqIFJhZGl1cyBvZiB0aGUgY2lyY2xlLCBjb21wdXRlZCBiYXNlZCBvbiB3aW5kb3cgd2lkdGhcbiAgICAgKi9cbiAgICByYWRpdXM6bnVtYmVyO1xuXG4gICAgLyoqXG4gICAgICogU3RhcnRpbmcgcG9zaXRpb24gdG8gZHJhdyBjb2x1bW5zXG4gICAgICovXG4gICAgc3RhcnRYOm51bWJlcjtcblxuICAgIC8qKlxuICAgICAqIFN0YXJ0aW5nIHBvc2l0aW9uIHRvIGRyYXcgcm93c1xuICAgICAqL1xuICAgIHN0YXJ0WTpudW1iZXI7XG5cbiAgICAvKipcbiAgICAgKiBOdW1iZXIgb2YgYml0cyAoY29sdW1ucykgcGVyIG51bWJlclxuICAgICAqL1xuICAgIGNvbHVtbnM6bnVtYmVyO1xuXG4gICAgLyoqXG4gICAgICogTnVtYmVyIG9mIG51bWJlcnMgKHJvd3MpXG4gICAgICovXG4gICAgcm93czpudW1iZXI7XG5cbiAgICAvKipcbiAgICAgKiBTcGFjaW5nIGlzIHRoZSB0b3RhbCBzcGFjZSB0aGF0IGVhY2ggY2lyY2xlIHRha2VzIHVwIHdpdGggcGFkZGluZ1xuICAgICAqL1xuICAgIHNwYWNpbmc6bnVtYmVyO1xuXG4gICAgLyoqXG4gICAgICogVGhlIGNhbnZhcyB0byBkcmF3IG9uXG4gICAgICovXG4gICAgY2FudmFzOkNhbnZhc1N0YWdlO1xuXG4gICAgLyoqXG4gICAgICogVGhlIHdpZHRoIG9mIHRoZSBjYW52YXNcbiAgICAgKi9cbiAgICB3aWR0aDpudW1iZXI7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgaGVpZ2h0IG9mIHRoZSBjYW52YXNcbiAgICAgKi9cbiAgICBoZWlnaHQ6bnVtYmVyO1xuXG4gICAgLyoqXG4gICAgICogVGhlIHBhZGRpbmcgc3Vycm91bmRpbmcgdGhlIGRyYXcgYXJlYVxuICAgICAqL1xuICAgIHBhZ2VQYWRkaW5nOm51bWJlciA9IDEwO1xuXG4gICAgLyoqXG4gICAgICogTWluaW11bSByYWRpdXMgb2YgY2lyY2xlIGluIHBpeGVsc1xuICAgICAqL1xuICAgIG1pbldpZHRoOm51bWJlciA9IDEwO1xuXG4gICAgLyoqXG4gICAgICogTWF4aW11bSBiaXRzIHRoZSBwYWdlIGNhbiBmaXRcbiAgICAgKi9cbiAgICBNYXhCaXRzOm51bWJlcjtcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBjYW52YXMgYW5kIGRyYXdzIGNpcmNsZXMgb24gaXQgdG8gcmVwcmVzZW50IChyb3cpIGJpbmFyeSBudW1iZXJzIG9mIChjb2x1bW5zKSBiaXQgbGVuZ3RoLlxuICAgICAqIEBwYXJhbSBjb2x1bW5zIC0gTnVtYmVyIG9mIGNvbHVtbnMgKGJpdHMpXG4gICAgICogQHBhcmFtIHJvd3MgLSBOdW1iZXIgb2Ygcm93cyAobnVtYmVycylcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcihjb2x1bW5zOm51bWJlcixyb3dzOm51bWJlcikge1xuICAgICAgICB0aGlzLmNvbHVtbnMgPSBjb2x1bW5zO1xuICAgICAgICB0aGlzLnJvd3MgPSByb3dzO1xuICAgICAgICBsZXQgcGFkZGluZzogbnVtYmVyID0gNTtcblxuICAgICAgICAvL0RldGVybWluZSB0aGUgZHJhd2luZyBhcmVhIHNpemVcbiAgICAgICAgdGhpcy53aWR0aCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibWFpblwiKSEub2Zmc2V0V2lkdGgtdGhpcy5wYWdlUGFkZGluZyoyO1xuICAgICAgICB0aGlzLmhlaWdodCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibWFpblwiKSEub2Zmc2V0SGVpZ2h0LXRoaXMucGFnZVBhZGRpbmcqMjtcbiAgICAgICAgXG5cbiAgICAgICAgLy9NYXhpbXVtIGNvbHVtbnMgd2UgY291bGQgaGF2ZSB3aXRoIHRoZSBtaW5XaWR0aFxuICAgICAgICB0aGlzLk1heEJpdHMgPSAgTWF0aC5mbG9vcigodGhpcy53aWR0aCkgLyAoKHRoaXMubWluV2lkdGgqMikrcGFkZGluZykpO1xuICAgICAgICB0aGlzLmNvbHVtbnMgPSBNYXRoLm1heChNYXRoLm1pbih0aGlzLk1heEJpdHMsIHRoaXMuY29sdW1ucyksMik7XG4gICAgICAgIGxldCBiaXRJbnB1dCA6IEhUTUxJbnB1dEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJpdHNcIikgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICAgICAgYml0SW5wdXQudmFsdWUgPSB0aGlzLmNvbHVtbnMudG9TdHJpbmcoKTtcblxuICAgICAgICAvLyBDb21wdXRlIHRoZSBtYXhpbXVtIHJhZGl1cyB0aGF0IGFsbG93cyBhbGwgdGhlIGNpcmNsZXMgdG8gZml0IG9uIHRoZSBwYWdlXG4gICAgICAgIHRoaXMucmFkaXVzID0gTWF0aC5tYXgoXG4gICAgICAgICAgICB0aGlzLm1pbldpZHRoLFxuICAgICAgICAgICAgTWF0aC5mbG9vcihcbiAgICAgICAgICAgICAgICBNYXRoLm1pbihcbiAgICAgICAgICAgICAgICAgICAgKCgodGhpcy53aWR0aCkgLSBwYWRkaW5nKnRoaXMuY29sdW1ucykvMikgLyB0aGlzLmNvbHVtbnMsXG4gICAgICAgICAgICAgICAgICAgICgoKHRoaXMuaGVpZ2h0KSAtIChwYWRkaW5nKih0aGlzLnJvd3MrMikpKS8yKSAvICh0aGlzLnJvd3MrMilcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApXG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc29sZS5sb2coKCgodGhpcy53aWR0aCkgLSBwYWRkaW5nKnRoaXMuY29sdW1ucykvMikgLyB0aGlzLmNvbHVtbnMpO1xuICAgICAgICBcbiAgICAgICAgLy9UaGUgc3BhY2UgYmV0d2VlbiBlYWNoIGNpcmNsZVxuICAgICAgICB0aGlzLnNwYWNpbmcgPSB0aGlzLnJhZGl1cyAqIDIgKyBwYWRkaW5nO1xuXG4gICAgICAgIC8vIERldGVybWluZSB0aGUgc3RhcnRpbmcgcG9zaXRpb24gdG8gZHJhdyB0aGUgY2lyY2xlc1xuICAgICAgICBsZXQgdG90YWxXaWR0aCA9IHRoaXMuY29sdW1ucyAqIHRoaXMuc3BhY2luZyAtIHBhZGRpbmcqMjtcbiAgICAgICAgbGV0IHN0YXJ0WCA9ICh0aGlzLndpZHRoIC0gdG90YWxXaWR0aCkgLyAyICsgdGhpcy5yYWRpdXM7XG4gICAgICAgIGxldCB0b3RhbEhlaWdodCA9ICgodGhpcy5yb3dzKzIpICogdGhpcy5zcGFjaW5nKTtcbiAgICAgICAgbGV0IHN0YXJ0WSA9ICh0aGlzLmhlaWdodCAtIHRvdGFsSGVpZ2h0KSAvIDI7XG5cbiAgICAgICAgdGhpcy5zdGFydFggPSBzdGFydFg7XG4gICAgICAgIHRoaXMuc3RhcnRZID0gc3RhcnRZO1xuXG4gICAgICAgIC8vIEluaXQgY2lyY2xlIGFycmF5XG4gICAgICAgIHRoaXMuY2lyY2xlcyA9IG5ldyBBcnJheSh0aGlzLnJvd3MpO1xuICAgICAgICB0aGlzLkJpbmFyeU51bWJlcnMgPSBuZXcgQXJyYXkodGhpcy5yb3dzKTtcblxuICAgICAgICAvLyBDcmVhdGUgY2FudmFzIHRvIGRyYXcgb25cbiAgICAgICAgdGhpcy5jYW52YXMgPSBuZXcgQ2FudmFzU3RhZ2UodGhpcyk7XG4gICAgICAgIHRoaXMucmVzdWx0cyA9IG5ldyBCaW5hcnlOdW1iZXIodGhpcyx0aGlzLnJvd3MrMSk7XG4gICAgICAgIFxuICAgICAgICAvLyBDcmVhdGVzIHRoZSBjaXJjbGVzIGZvciBlYWNoIHJvdyAobnVtYmVyKSB3aXRoIHRoZSBhbW91bnQgb2YgYml0cyAoY29sdW1ucykgcmVxdWVzdGVkLlxuICAgICAgICBmb3IgKGxldCByID0gMDsgciA8IHRoaXMucm93czsgcisrKSB7XG4gICAgICAgICAgICB0aGlzLkJpbmFyeU51bWJlcnNbcl0gPSBuZXcgQmluYXJ5TnVtYmVyKHRoaXMscik7XG4gICAgICAgIH1cbiAgICB9XG59XG4iLCJpbXBvcnQgeyBDaGFuZ2VCaXRTaXplIH0gZnJvbSBcIi5cIjtcbmltcG9ydCB7IEJpbmFyeU51bWJlciB9IGZyb20gXCIuL0JpbmFyeU51bWJlclwiO1xuaW1wb3J0IHsgRW52aXJvbm1lbnQgfSBmcm9tIFwiLi9FbnZpcm9ubWVudFwiO1xuXG4vKipcbiAqIENvbnZlcnRzIGJpbmFyeSByZXByZXNlbnRhdGlvbiB0byBkZWNpbWFsLCBwZXJmb3JtcyB0aGUgZGVzaXJlZCBtYXRoIGZ1bmN0aW9uLCB0aGVuIGRpc3BsYXlzIHRoZSByZXN1bHRzIGluIGJpbmFyeVxuICogQHBhcmFtIGVudiAtIEVudmlyb25tZW50IHVzZWQgdG8gY29tcHV0ZSB2YWx1ZXNcbiAqIFxuICogVE9ETzogQWxsb3cgY2hvb3Npbmcgb2Ygb3BlcmFuZCAoYWRkLHN1YnRyYWN0LG11bHRpcGx5LGRpdmlkZSlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIENvbXB1dGUoZW52OiBFbnZpcm9ubWVudCk6IHZvaWQge1xuXG4gICAgbGV0IHJlc3VsdHM6bnVtYmVyID0gMDtcbiAgICBmb3IgKGxldCByID0gMDsgciA8IGVudi5yb3dzOyByKyspIHtcbiAgICAgICAgcmVzdWx0cyArPSBlbnYuQmluYXJ5TnVtYmVyc1tyXS5nZXREZWNpbWFsKCk7XG4gICAgfVxuICAgIGVudi5yZXN1bHRzLnNldERlY2ltYWwocmVzdWx0cyk7XG59IiwiaW1wb3J0IHsgRW52aXJvbm1lbnQgfSBmcm9tIFwiLi9FbnZpcm9ubWVudFwiO1xuXG5leHBvcnQgY2xhc3MgVmlzdWFsQml0IHtcbiAgICAvKipcbiAgICAgKiBDbGFzcyB0aGF0IGhvbGRzIGluZm8gYWJvdXQgYSBjaXJjbGUgZHJhd24gb24gYW4gSFRNTCBjYW52YXMsIHJlcHJlc2VudGluZyBhIHZpc3VhbCBiaXQgb2YgZGF0YS5cbiAgICAgKi9cblxuICAgIHNldDpCb29sZWFuO1xuICAgIHg6bnVtYmVyO1xuICAgIHk6bnVtYmVyO1xuICAgIHJhZGl1czpudW1iZXI7XG4gICAgbGVmdDogbnVtYmVyO1xuICAgIHRvcDogbnVtYmVyO1xuICAgIHJpZ2h0OiBudW1iZXI7XG4gICAgYm90dG9tOiBudW1iZXI7XG4gICAgZW52OiBFbnZpcm9ubWVudDtcbiAgICBmaWxsQ29sb3I6IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIFxuICAgICAqIEBwYXJhbSB4IENlbnRlcnBvaW50IFggY29vcmRpbmF0ZSB0byBkcmF3IGNpcmNsZVxuICAgICAqIEBwYXJhbSB5IENlbnRlcnBvaW50IFkgY29vcmRpbmF0ZSB0byBkcmF3IGNpcmNsZVxuICAgICAqIEBwYXJhbSByYWRpdXMgUmFkaXVzIG9mIGNpcmNsZSB0byBkcmF3XG4gICAgICogQHBhcmFtIGVudiBDYW52YXMgY29udGV4dCB0byBkcmF3IG9uXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoeCA6IG51bWJlciwgeTogbnVtYmVyLCByYWRpdXM6bnVtYmVyLCBlbnY6IEVudmlyb25tZW50KVxuICAgIGNvbnN0cnVjdG9yKHggOiBudW1iZXIsIHk6IG51bWJlciwgcmFkaXVzOm51bWJlciwgZW52OiBFbnZpcm9ubWVudCwgc2V0PzpCb29sZWFuKSB7XG4gICAgICAgIHRoaXMueCA9IHg7XG4gICAgICAgIHRoaXMueSA9IHk7XG4gICAgICAgIHRoaXMuc2V0ID0gc2V0ID8/IGZhbHNlO1xuICAgICAgICB0aGlzLnJhZGl1cyA9IHJhZGl1cztcbiAgICAgICAgdGhpcy5sZWZ0ID0gdGhpcy54LXJhZGl1cy0xO1xuICAgICAgICB0aGlzLnRvcCA9IHRoaXMueS1yYWRpdXMtMTtcbiAgICAgICAgdGhpcy5yaWdodCA9IHRoaXMueCtyYWRpdXMrMTtcbiAgICAgICAgdGhpcy5ib3R0b20gPSB0aGlzLnkrcmFkaXVzKzE7XG4gICAgICAgIHRoaXMuZW52ID0gZW52O1xuICAgICAgICB0aGlzLmZpbGxDb2xvciA9IFwid2hpdGVcIjtcbiAgICAgICAgdGhpcy5kcmF3KCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU3dpdGNoZXMgdGhlIGJpdCB2YWx1ZSBhbmQgcmVkcmF3XG4gICAgICovXG4gICAgc3dpdGNoQml0KCkge1xuICAgICAgICB0aGlzLnNldCA9ICF0aGlzLnNldDtcbiAgICAgICAgdGhpcy5kcmF3KCk7XG4gICAgICAgIFxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIGJpdCB2YWx1ZSBmb3IgdGhlIGNpcmNsZSB0byB0aGUgcHJvdmlkZWQgYml0IGFuZCByZWRyYXdcbiAgICAgKiBAcGFyYW0gYml0IC0gU2V0dGluZyB0byBhcHBseSB0byB0aGUgYml0XG4gICAgICovXG4gICAgc2V0Qml0KGJpdDogYm9vbGVhbikge1xuICAgICAgICB0aGlzLnNldCA9IGJpdDtcbiAgICAgICAgdGhpcy5kcmF3KCk7XG4gICAgfVxuXG4gICAgc2V0T3ZlcmZsb3cob3ZlcmZsb3c6IGJvb2xlYW4pIHtcbiAgICAgICAgaWYob3ZlcmZsb3cpIHRoaXMuZmlsbENvbG9yID0gXCJyZWRcIjsgXG4gICAgICAgIGVsc2UgdGhpcy5maWxsQ29sb3IgPSBcIndoaXRlXCI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRHJhd3MgdGhlIGNpcmNsZVxuICAgICAqIEBwYXJhbSBjb250ZXh0IC0gVGhlIGNhbnZhcyBjb250ZXh0IHRvIGRyYXcgb25cbiAgICAgKi9cbiAgICBkcmF3KCk6IHZvaWQge1xuICAgICAgICBjb25zdCBjb250ZXh0OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQgPSB0aGlzLmVudi5jYW52YXMuY29udGV4dDtcbiAgICAgICAgY29udGV4dC5jbGVhclJlY3QodGhpcy5sZWZ0LCB0aGlzLnRvcCwgdGhpcy5yYWRpdXMqMisyLCB0aGlzLnJhZGl1cyoyKzIpO1xuICAgICAgICBjb250ZXh0LmJlZ2luUGF0aCgpO1xuICAgICAgICBjb250ZXh0LmFyYyh0aGlzLngsIHRoaXMueSwgdGhpcy5yYWRpdXMsIDAsIDIgKiBNYXRoLlBJKTtcbiAgICAgICAgY29udGV4dC5maWxsU3R5bGUgPSB0aGlzLnNldCA/IHRoaXMuZmlsbENvbG9yIDogXCIjMGYwZjBmXCI7XG4gICAgICAgIGNvbnRleHQuc3Ryb2tlU3R5bGUgPSB0aGlzLnNldCA/IFwiIzk1YzI5OVwiIDogXCIjMzMwNDAwXCIgO1xuICAgICAgICBjb250ZXh0LmZpbGwoKTtcbiAgICAgICAgY29udGV4dC5zdHJva2UoKTtcbiAgICAgICAgY29udGV4dC5jbG9zZVBhdGgoKTtcbiAgICB9XG59IiwiaW1wb3J0IHsgQmluYXJ5TnVtYmVyIH0gZnJvbSBcIi4vQmluYXJ5TnVtYmVyXCI7XG5pbXBvcnQgeyBkZWJvdW5jZSB9IGZyb20gXCIuL0RlYm91bmNlVmFsdWVcIjtcbmltcG9ydCB7IEVudmlyb25tZW50IH0gZnJvbSBcIi4vRW52aXJvbm1lbnRcIjtcblxubGV0IGVudjogRW52aXJvbm1lbnQ7XG5sZXQgZGVib3VuY2VXaW5kb3dSZXNpemUgPSBkZWJvdW5jZShEZWxldGVDYW52YXMsIDIwMCk7XG5sZXQgZGVib3VuY2VCaXRSZXNpemUgPSBkZWJvdW5jZShjaGFuZ2VCaXRzLCAyMDApO1xubGV0IGNvbHVtbnM6IG51bWJlciA9IDg7XG5sZXQgcm93czogbnVtYmVyID0gMjtcblxuQ3JlYXRlKCk7XG5cbi8qKlxuICogSGFuZGxlcyB0aGUgY3JlYXRpb24gb2YgdGhlIEVudmlyb25tZW50LiBBZGRzIGEgaGFuZGxlciB0byB0aGUgd2luZG93IHRoYXQgd2lsbCByZWNyZWF0ZSB0aGUgRW52aXJvbm1lbnQgd2hlbmV2ZXIgdGhlIHdpbmRvdyBpcyByZXNpemVkLlxuICovXG5mdW5jdGlvbiBDcmVhdGUoKSB7XG4gICAgQ3JlYXRlRW52aXJvbm1lbnQoKTtcblxuICAgIC8vIERlYm91bmNlZCB3aW5kb3cgcmVzaXplIGlucHV0IGhhbmRsZXJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGRlYm91bmNlV2luZG93UmVzaXplKCk7XG4gICAgfSk7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyBFbnZpcm9ubWVudFxuICovXG5mdW5jdGlvbiBDcmVhdGVFbnZpcm9ubWVudCgpOiB2b2lkIHtcbiAgICBlbnYgPSBuZXcgRW52aXJvbm1lbnQoY29sdW1ucyxyb3dzKTtcbn1cblxuLyoqXG4gKiBEZWxldGVzIHRoZSBDYW52YXMsIGFuZCBjcmVhdGVzIGEgbmV3IEVudmlyb25tZW50XG4gKi9cbmZ1bmN0aW9uIERlbGV0ZUNhbnZhcygpe1xuICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZXdwb3J0XCIpICE9IG51bGwpIHtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWV3cG9ydFwiKSEucmVtb3ZlKCk7XG5cbiAgICAgICAgY29uc3Qgc3RvcmVOdW1iZXJzOiBCaW5hcnlOdW1iZXJbXSA9IGVudi5CaW5hcnlOdW1iZXJzO1xuICAgICAgICBjb25zdCByZXN1bHROdW1iZXI6IEJpbmFyeU51bWJlciA9IGVudi5yZXN1bHRzO1xuXG4gICAgICAgIENyZWF0ZUVudmlyb25tZW50KCk7XG5cbiAgICAgICAgZW52LnJlc3VsdHMuc2V0RGVjaW1hbChyZXN1bHROdW1iZXIuZ2V0RGVjaW1hbCgpKTtcbiAgICAgICAgXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3RvcmVOdW1iZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgbGV0IGJpbmFyeVZhbHVlID0gc3RvcmVOdW1iZXJzW2ldLmdldEJpbmFyeSgpO1xuICAgICAgICAgICAgICAgIGJpbmFyeVZhbHVlID0gYmluYXJ5VmFsdWUuc3Vic3RyaW5nKGJpbmFyeVZhbHVlLmxlbmd0aC1jb2x1bW5zKTtcbiAgICAgICAgICAgICAgICBlbnYuQmluYXJ5TnVtYmVyc1tpXS5zZXREZWNpbWFsKHBhcnNlSW50KGJpbmFyeVZhbHVlLDIpKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIENoYW5nZUJpdFNpemUoYml0czogbnVtYmVyKSB7XG4gICAgZGVib3VuY2VCaXRSZXNpemUoYml0cyk7XG59XG5cbmZ1bmN0aW9uIGNoYW5nZUJpdHMoYml0czogbnVtYmVyKSB7XG4gICAgYml0cyA9IE1hdGgubWluKGVudi5NYXhCaXRzLGJpdHMpO1xuICAgIGJpdHMgPSBNYXRoLm1heCgyLGJpdHMpO1xuICAgIGxldCBiaXRJbnB1dCA6IEhUTUxJbnB1dEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJpdHNcIikgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICBiaXRJbnB1dC52YWx1ZSA9IGJpdHMudG9TdHJpbmcoKTtcbiAgICBjb2x1bW5zID0gYml0cztcbiAgICBEZWxldGVDYW52YXMoKTtcbn1cbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBzdGFydHVwXG4vLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8vIFRoaXMgZW50cnkgbW9kdWxlIGlzIHJlZmVyZW5jZWQgYnkgb3RoZXIgbW9kdWxlcyBzbyBpdCBjYW4ndCBiZSBpbmxpbmVkXG52YXIgX193ZWJwYWNrX2V4cG9ydHNfXyA9IF9fd2VicGFja19yZXF1aXJlX18oNjA3KTtcbiJdLCJuYW1lcyI6WyJlbnYiLCJyb3ciLCJkZWNpbWFsVmFsdWUiLCJ0aGlzIiwiYmluYXJ5VmFsdWUiLCJ0b1N0cmluZyIsIm5ld0JpdHMiLCJNYXRoIiwicm91bmQiLCJsZW5ndGgiLCJiaXRzIiwiY29sdW1ucyIsIlZpc3VhbEJpdHMiLCJBcnJheSIsImNyZWF0ZVZpc3VhbEJpdHMiLCJzZXREZWNpbWFsIiwic2V0Q2lyY2xlVmFsdWVzIiwib3ZlcmZsb3ciLCJiaW5hcnkiLCJzdWJzdHJpbmciLCJzZXRDaGFyQXQiLCJpIiwic2V0T3ZlcmZsb3ciLCJzZXRCaXQiLCJjaGFyQXQiLCJjIiwiYWRkVmlzdWFsQml0IiwiY29sdW1uIiwiVmlzdWFsQml0Iiwic3RhcnRYIiwic3BhY2luZyIsInN0YXJ0WSIsInJhZGl1cyIsImdldERlY2ltYWwiLCJnZXRCaW5hcnkiLCJpbmRleCIsImJvb2wiLCJzZXQiLCJwYXJzZUludCIsInVwZGF0ZUJpbmFyeVN0cmluZyIsInBhZFN0YXJ0Iiwic3RyIiwiY2hyIiwiQmluYXJ5TnVtYmVyIiwiZW52aXJvbm1lbnQiLCJjb250YWluZXJEaXYiLCJkb2N1bWVudCIsImJvZHkiLCJzdHlsZSIsImJhY2tncm91bmRDb2xvciIsImNhbnZhcyIsImNyZWF0ZUVsZW1lbnQiLCJFcnJvciIsImlkIiwiZ2V0RWxlbWVudEJ5SWQiLCJhcHBlbmQiLCJjb250ZXh0IiwiZ2V0Q29udGV4dCIsImNsYXNzQWNjZXNzb3IiLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsIm1vdXNlQ2xpY2tFdmVudCIsIkNvbXB1dGUiLCJiaXRzSW5wdXQiLCJ2YWx1ZSIsIkNoYW5nZUJpdFNpemUiLCJ3aWR0aCIsImhlaWdodCIsImRyYXdMaW5lIiwiZ2V0TW91c2VQb3NpdGlvbiIsImV2ZW50IiwicmVjdCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInNjYWxlWCIsInNjYWxlWSIsIngiLCJjbGllbnRYIiwibGVmdCIsInkiLCJjbGllbnRZIiwidG9wIiwibW91c2VQb3MiLCJyb3dzIiwiY29sIiwiQmluYXJ5TnVtYmVycyIsImJlZ2luUGF0aCIsInlQb3MiLCJ4UG9zIiwibW92ZVRvIiwibGluZVRvIiwic3Ryb2tlU3R5bGUiLCJzdHJva2UiLCJjbG9zZVBhdGgiLCJkcmF3QnV0dG9ucyIsIkNhbnZhc1N0YWdlIiwiY2FsbGJhY2siLCJ3YWl0Iiwic3RhdGUiLCJ1bmRlZmluZWQiLCJwcm9taXNlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJjbGVhclRpbWVvdXQiLCJ0aW1lb3V0IiwibGF0ZXN0QXJncyIsImFyZ3MiLCJzZXRUaW1lb3V0IiwicyIsIkVudmlyb25tZW50IiwicGFnZVBhZGRpbmciLCJtaW5XaWR0aCIsIm9mZnNldFdpZHRoIiwib2Zmc2V0SGVpZ2h0IiwiTWF4Qml0cyIsImZsb29yIiwibWF4IiwibWluIiwiY29uc29sZSIsImxvZyIsInRvdGFsV2lkdGgiLCJwYWRkaW5nIiwidG90YWxIZWlnaHQiLCJjaXJjbGVzIiwicmVzdWx0cyIsInIiLCJyaWdodCIsImJvdHRvbSIsImZpbGxDb2xvciIsImRyYXciLCJzd2l0Y2hCaXQiLCJiaXQiLCJjbGVhclJlY3QiLCJhcmMiLCJQSSIsImZpbGxTdHlsZSIsImZpbGwiLCJkZWJvdW5jZVdpbmRvd1Jlc2l6ZSIsImRlYm91bmNlIiwiRGVsZXRlQ2FudmFzIiwiZGVib3VuY2VCaXRSZXNpemUiLCJDcmVhdGVFbnZpcm9ubWVudCIsInJlbW92ZSIsInN0b3JlTnVtYmVycyIsInJlc3VsdE51bWJlciIsIndpbmRvdyIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsImV4cG9ydHMiLCJtb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIl0sInNvdXJjZVJvb3QiOiIifQ==